(library
 (flags
  (:standard -w +A-39-4-42))
 (name nuscrlib)
 (public_name nuscr.lib)
 (libraries base stdio ocamlgraph ppxlib unix)
 (preprocess
  (pps ppx_deriving.show ppx_deriving.eq ppx_deriving.ord ppx_sexp_conv
    ppxlib.metaquot)))

(ocamllex
 (modules lexer pragmalexer))

(menhir
 (modules parser pragmaparser)
 (flags
  ("--explain" "-la" "2")))

(rule
  (deps parserMessages.check)
  (action (with-stdout-to parserMessages.ml
    (run menhir
      %{dep:parser.mly}
      --compile-errors %{dep:parserMessages.messages}
    )
  ))
)

(rule
  (with-stdout-to parserMessages.auto.messages
    (run menhir
       %{dep:parser.mly}
       --list-errors
    )
  )
)

(rule
  (with-stdout-to parserMessages.check
  (run menhir
    %{dep:parser.mly}
    --compare-errors %{dep:parserMessages.auto.messages}
    --compare-errors %{dep:parserMessages.messages}
  ))
)
